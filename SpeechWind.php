<?header('Content-Type: text/html; charset=utf-8');//собираем всю информацию об защедщих на сайт	session_start();include_once('startup.php');	// Установка параметров, подключение к БД, запуск сессии.	startup();//прооверяем, что мы админinclude('variables.php');if($_SESSION['Guest_id']['id_user'] == $AdminID){ 	include('rss_scripts.php');}else{//echo 'Вы не Админ!!!';}	?>	<?		$SpeechArr = array(); //массив всех реч		$ArrMonth = array('','января','февраля','марта','апреля','мая','июня','июля','августа','сентября','октября','ноября','декабря');	$avtor='';				//если это ссылка из sitema, то мы берем номера этих речей, вытаскиваем первую и последнюю дату и авторов этих речейif(isset($_GET['IdSBEnd'])){ 	$IdSBEnd = mysql_real_escape_string($_GET['IdSBEnd']);	//разбиваем на начало конец	$IdSBEnd = explode("|",$IdSBEnd);	$IdBeg =  sprintf("%d", $IdSBEnd[0]);	$IdEnd =  sprintf("%d", $IdSBEnd[1]);	//metka1 - отбираем потом только нужные	if($IdBeg AND $IdEnd){//вытаскиваем эти номера из базы		if(($IdEnd -$IdBeg)<50){			$query = "SELECT * FROM  Speech_from_News WHERE id BETWEEN $IdBeg AND $IdEnd";			//echo $query;			$result = mysql_query($query) or die(mysql_error());			$n = mysql_num_rows($result);			if($n >0){				$arrD = array();				$arrW = array();				for ($i = 0; $i < $n; $i++)				{					$row = mysql_fetch_assoc($result);							$arrD[]  = $row['date'];					$arrW[]  = $row['id_who'];									}				$arrW = array_unique($arrW);								//var_dump($arrD);				//var_dump($arrW);				//4-11-2014				//находим дыты окончания и начала				$dB = min($arrD); $dB=explode(" ",$dB); $dB = explode("-",$dB[0]); 				$dE = max($arrD); $dE=explode(" ",$dE); $dE = explode("-",$dE[0]);				//var_dump($dB);				//var_dump($dE);												$_POST['DateBeg'] = $dB[2]."-".$dB[1]."-".$dB[0];				$_POST['DateEnd'] = $dE[2]."-".$dE[1]."-".$dE[0];												//echo "<br/>dB-".$_POST['DateBeg']." dE-".$_POST['DateEnd']."<br/>";												$_GET['avtor'] = implode("|",$arrW);			}							}else{			echo "слишком большой разброс номеров речи!"; die();		}	}}					//вытаскиваем id авторов 		if(isset($_GET['avtor'])){		$arrAvt = explode('|',$_GET['avtor']);		$arrAvt = array_diff($arrAvt, array(''));		foreach($arrAvt as $avt){			$id_avtor = sprintf("%d",$avt);//номер/ключ речи в новости			$SpeechArr[] = array('id_avtor'=>$id_avtor);//7			}	$avtor=$_GET['avtor'];	}		//вытаскиваем id авторов 	if(isset($_POST['avtor'])){		$arrAvt = explode('|',$_POST['avtor']);		$arrAvt = array_diff($arrAvt, array(''));		foreach($arrAvt as $avt){			$id_avtor = sprintf("%d",$avt);//номер/ключ речи в новости			$SpeechArr[] = array('id_avtor'=>$id_avtor);//7			}	$avtor=$_POST['avtor'];		}		$titleStr ='';	//вытаскиваем всех авторов(если в дальнейшем будет висеть, то сделать при клике на ссылку)	$query = "SELECT * FROM  Speech_Who ORDER BY Who";	$result = mysql_query($query) or die(mysql_error());		$n = mysql_num_rows($result);		if($n >0){			$arrWho = array();			for ($i = 0; $i < $n; $i++)			{				$row = mysql_fetch_assoc($result);						$arrWho[] = $row;				if($row['id'] ==$SpeechArr[0]['id_avtor']){ $titleStr = $row['Who'].". ".$row['descript'].":";	}			}		}	?>	<html><head>	<title><?=$titleStr?> речи, высказывания, обращения, выступления, диалоги, разговоры и дискуссии </title></head>	<body style="position:relative;" ><script type="text/javascript" src="js/jquery.js"></script> <!--подключаем --><style>#SpeechFilterForm, .vdiskus{ 	background: -webkit-gradient(linear, left top, right  top, from(#EAEAEA), to(#BBBBBB)); background: -moz-linear-gradient(left top, #EAEAEA, #BBBBBB);  }/*Постраничная навигация*/.pstrnav {	background:#BBBBBB;	padding: 0px 10px 20px 15px;	color:#424242;}.pstrnav a{	font-family : Verdana, Geneva, Arial, Helvetica, sans-serif; font-size:16px;color:#245E93; text-decoration:underline;}</style><!--[if IE]><style>	#SpeechFilterForm{ 		height:200px; 		filter:progid:DXImageTransform.Microsoft.Gradient(			startColorStr='#EAEAEA', endColorStr='#BBBBBB', gradientType='0'		);	}	.vdiskus{		background:#BBBBBB;	}</style><![endif]--><br /><a class='vdiskus' href="index.php" title="Все новости в России и Мире, и Политика " ><< Главная страница!</a> |<!--<a class='vdiskus' href="index.php?c=soobsh" title="Российские и мировые политические новости " > Новостной обзор</a> |--><a class='vdiskus' href="PersonsStruct.php?avtor=all" title="Известные личности, историки, политики, аналитики и руководители в структуре мирового порядка (структура подчиненностей)" > Подчиненность известных личностей</a> |<!--<a class='vdiskus' href="EventsDate.php" title="График событий, происшествий и новостей на временной шкале (хроника событий)" > События на шкале времени</a>--><br /><b>Выводите на экран диалоги и высказывания знаменитых людей . <a href='pass.php' style='text-decoration:none; color:black;'>П<a/>осмотрите что из этого получится.</b><a href="SpeechWind.php?AllBy5">Вывести по 5!</a><br />		<!--Форма фильтра -->	<div id="SpeechFilterForm" style='padding:8px;' >		<form id='AvtorForm' method='post' action='SpeechWind.php' >			<input type='hidden' value='<?=$avtor?>' name='avtor' id='avtorsIds' />						<fieldset style='float:left;'>			 <legend><b>Добавте еще "Автора" высказываний</b></legend>			 <input   onkeyup='ChangeAvtors(this)' name='avtorName' id='avtorNameId' /> <b>или выберите</b>			<select id='selectMod'  name='avtorNameCh' onChange='SelectAvtor(this)' >				<?foreach($arrWho as $w){?>				<option value='<?=$w['id']?>' ><?=$w['Who']?></option>				<?}?>			</select>			<br />			<input type='submit' value='добавить' />			</fieldset>									<fieldset style='float:left;'>			<legend><b>Фильтр</b></legend>			<div>				<div style='float:left;'>					<b>Диапазон дат</b><br />					<input type='text'  style='width:70px;' value='<?=$_POST['DateBeg']?>' onclick='kalend(this,event);' name='DateBeg' id='DateBeg' /><b> начало</b>					<br />					<input type='text' style='width:70px;' value='<?=$_POST['DateEnd']?>' onclick='kalend(this,event);' name='DateEnd' id='DateEnd' /><b> окончание</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;					<br />				</div>				<div style='float:left; ' >					<b>Ключевые слова</b><br />					<input type='text' value='<?=$_POST['KeyWords']?>'  name='KeyWords' id='KeyWords' /> 					<br />				</div>			</div>			<div style="clear:both;"></div>			<input type='submit' value='отобрать по фильтру' /> 						</fieldset>						<div style="clear:both;"></div>		</form>	</div>			<hr />		<?if($avtor !=''){ ?>			<a class='vdiskus' style="" href='SpeechWind.php' title='Вывести всех авторов (известных людей),  чьи речи и высказывания присутствуют на сайте'><Показать всех авторов (известных личностей)></a>|		<?}?>		<a class='vdiskus' href='PersonsStruct.php?avtor=all' title='Вывести структуру подчиненности (иерархию) всех авторов (известных) людей'><Показать структуру всех авторов></a>		<?//если мы всетаки ввели полностью avtorName и нажали добавить, а не выбрали из селекта, то ищем в массиве таких авторов	if(isset($_POST['avtorName'])){		if($_POST['avtorName'] !=''){			$foundAvt = false;			foreach($arrWho as $wh){				if(mb_strtolower($wh['Who'], 'UTF-8') == mb_strtolower($_POST['avtorName'], 'UTF-8')){				$foundAvt = true;				?><script>				//alert('yes');					document.getElementById('avtorsIds').value +='|<?=$wh['id']?>';					document.getElementById('AvtorForm').submit();					</script><?				}						}			if(!$foundAvt){?><script>alert('Такого автора не найдено!!! <?=$_POST['avtorName']?>');</script><?}		}	}	?>	<link rel="stylesheet" type="text/css" href="blocks/calendarStyle.css"  /> <!--подключаем стили календарей -->	 <script type="text/javascript" src="blocks/dinamic_scripts/CreateElementOnScreen.js"></script><!--подключаем для создания плавающих окон -->		 <script>	 //скрипт работы с календарем		var id_calend_call = ''; //id вызвавшего календарь элемента				function require(url, callback){	//функция которая подгружает скрипт и запускает в нем функцию					var script = document.createElement("script")						script.type = "text/javascript";				if (script.readyState) { //IE					script.onreadystatechange = function() {						if (script.readyState == "loaded" 						|| script.readyState == "complete") {							script.onreadystatechange = null;							callback();						}					};				} else { //Others					script.onload = function() {						callback();					};				}				script.src = url;				document.getElementsByTagName("head")[0].appendChild(script);			}							function kalend(obj,event){//функция, которая выводит календарь на экран			id_calend_call = obj.id;			if(document.getElementById('CalendarDiv')){ deleteCal();}//удаляем календарь если он уже вызван			var opt = new Array(); //параметры			opt.IndexZ = 3; //IndexZ			//opt.fixed = 'fix'; //означает, что она зафиксирована экране			var elemCal = CreateElementOnScreen(260,event,opt);			elemCal.innerHTML = "<span onclick='deleteCal()' style='cursor:pointer; float:right; margin: -10px -5px 0 0;' > <span style='color:black;'>_</span><b>x</b><span style='color:black;'>_ </span></span><br />";  //закрывание этого списка			elemCal.innerHTML += "<div id='calendar'></div>";			elemCal.id += "CalendarDiv";//			elemCal.style['background'] = 'url(../img/fon.png)';						document.body.appendChild(elemCal);					var date = new Date();			require("blocks/calendarN.js", function(){ calendar_show(date.getDate(),date.getMonth()+1,date.getFullYear()); });		}				function deleteCal(){//удаляем календарь				var elem = document.getElementById('CalendarDiv');				elem.style.display = 'none';				elem.parentNode.removeChild(elem);		}				function InsertDate(obj){//вставляем дату из календаря в элемент его вызвавший				var elem = document.getElementById(id_calend_call);				elem.value = obj;				deleteCal();		}	</script>	<script>		function SelectAvtor(obj){//добавление в форму id автора и отправка формы			// if (this.options.[this.selectedIndex].value == "3" ){}			//alert('fff'+obj.options[obj.selectedIndex].value);			var avtIds = document.getElementById('avtorsIds');			avtIds.value +='|'+obj.options[obj.selectedIndex].value;			document.getElementById('avtorNameId').value = '';//очишаем имя автора			document.getElementById('AvtorForm').submit();		}		 		function ChangeAvtors(obj){//функция поиска в БД авторов по буквам			if (obj.value.length > 2){				//вытаскиваем всех авторов у которых один из имен начинается на эти буквы				var arr;				$.ajax({				  async: false, 				  url: 'blocks/dinamic_scripts/Find_Avtors.php',				  data: {name:obj.value},				  type: "POST",				  success: function(data) {  arr = data; },				dataType: 'json'				 })						if(arr){					var Sel = document.getElementById('selectMod');					Sel.innerHTML= '';					Sel.multiple = true;					for(var i=0; i<arr.length; i++){						var arr1 = arr[i].split('|');						//alert(arr1[0]+"---"+arr1[1]);						var opt = document.createElement('option');						opt.value = arr1[0];						opt.innerHTML = arr1[1];						Sel.appendChild(opt);					}				}			}		}	</script>					<?	if(isset($_GET['AllBy5'])){//выводим список по 5(для индексации)	$query = "SELECT id,speech FROM Speech_from_News ORDER BY id";		$result = mysql_query($query);// or die(mysql_error());		//return mysql_fetch_assoc($result);		if (!$result)			die(mysql_error().$query);				// Извлечение из БД.		$n = mysql_num_rows($result);		$arr = array();					for ($i = 0; $i < $n; $i++)		{			$row = mysql_fetch_assoc($result);					$arr[] = $row;		}				//вытаскиваем переменную $numof из файла (сколько коментов на странице)		//include('../variables.php');		$k=0;		$idB='';		$idE='';		$arrRet = array();		for($i=0; $i<count($arr); $i++){			$k++; if($k>5){ $k=1;}			if($k==1){ $idB=$arr[$i]['id'];}//если это первый номер из пяти, то записываем его id (речи)			if($k==5){ //если это последний номер из пяти, то записываем его id (речи) и pfgbcsdftv ccskre				$idE=$arr[$i]['id'];				$IdSBEnd = $idB."|".$idE;								$arrRet[$i]['url'] = 'SpeechWind.php?IdSBEnd='.$IdSBEnd; //soobsh&id_soobsh=23				//	 $time = explode(" ",$arr[$i]['date']);				//$arrRet[$i]['lastmod']	= $time['0'];				//$arrRet[$i]['changefreq']	= 'daily';				//$arrRet[$i]['priority']	= '0.8';				$arrRet[$i]['speech'] = $arr[$i]['speech'];				$arrRet[$i]['id_sp'] = $IdSBEnd;			}		}				echo "<br />";		foreach($arrRet as $sp){			$IdSBEnd = explode("|",$sp['id_sp']);		?>			<a href='<?=$sp['url']?>' title='<?=$sp['speech']?>' >Показать речь в базе номера <?=$IdSBEnd[0]?>-<?=$IdSBEnd[1]?> </a><br />		<?}}					if($avtor !=''){ //н-11111-1 если авторы выбраны или мы выводим не по 5	$whereDate = '';	//смотрим даты если есть	if(isset($_POST['DateBeg']) AND isset($_POST['DateEnd'])){		$_POST['DateBeg'] =  mysql_real_escape_string($_POST['DateBeg']);		$_POST['DateEnd'] =  mysql_real_escape_string($_POST['DateEnd']);		if(($_POST['DateBeg'] !='') AND ($_POST['DateEnd'] !='')){			$arrBeg = explode("-",$_POST['DateBeg']); $DateBeg = $arrBeg[2]."-".$arrBeg[1]."-".$arrBeg[0];			$arrEnd = explode("-",$_POST['DateEnd']); $DateEnd = $arrEnd['2']."-".$arrEnd['1']."-".$arrEnd['0'];			$whereDate = " AND date BETWEEN STR_TO_DATE('".$DateBeg." 00:00:00', '%Y-%m-%d %H:%i:%s') AND STR_TO_DATE('".$DateEnd." 23:59:59', '%Y-%m-%d %H:%i:%s')";		}	}		$whereKeys = '';	//смотрим по ключевым словам если есть	if(isset($_POST['KeyWords'])){		$_POST['KeyWords'] =  mysql_real_escape_string($_POST['KeyWords']);		if(($_POST['KeyWords'] !='')){			$ArrKey = explode(" ",$_POST['KeyWords']);				$KeyWords = "";				for($i=0; $i<2; $i++){//только для двух слов					//преобразуем слова под запрос					if(isset($ArrKey[$i])){						$n = mb_strlen($ArrKey[$i],'UTF-8');						if($n >6){							$ArrKey[$i] = mb_substr($ArrKey[$i],0,$n-3,'UTF-8');							$ArrKey[$i]= $ArrKey[$i]."___";						}elseif($n >4){							$ArrKey[$i] = mb_substr($ArrKey[$i],0,$n-2,'UTF-8');							$ArrKey[$i]= $ArrKey[$i]."__";						}else{							$ArrKey[$i] =  $ArrKey[$i];						}						if($i==1){$KeyWords .=" ";}							$KeyWords .= "".$ArrKey[$i];										}				}			$whereKeys = " AND speech LIKE '%".$KeyWords."%' ";		}	}	//Вытаскиваем речь автора	for($k=0; $k<count($SpeechArr); $k++){				$query = "SELECT *,s.id as id_speech FROM  Speech_from_News s		INNER JOIN Speech_Who w ON s.id_who=w.id		WHERE s.id_who = '".$SpeechArr[$k]['id_avtor']."' $whereDate  $whereKeys ORDER BY s.id DESC"; //(в % дальнейшем % все связанное с данной таблицей можно объединить в один запрос)	//	echo $query."<br />";		$result = mysql_query($query) or die(mysql_error());		$n = mysql_num_rows($result);		if($n >0){			$arr = array();			for ($i = 0; $i < $n; $i++)			{				$row = mysql_fetch_assoc($result);						$arr[] = $row;			}			$SpeechArr[$k]['SpeechArr']=$arr;		}	}	//пробегаемся по всем массивам и находим все даты	$arrOfDate = array();		// var_dump($SpeechArr);	foreach($SpeechArr as $speechMem){		if($speechMem['SpeechArr']){			foreach($speechMem['SpeechArr'] as $speech){				$arrOfDate[] = $speech['date'];			}		}		//echo "<hr />";	}				//удаляем повторяюшиеся даты	$arrOfDate = array_unique($arrOfDate);		//порядочиваем массив	arsort($arrOfDate);	echo "<hr />";	//выводим авторов у которых найдена речь и у которых не найдена	echo "<div class='vdiskus' ><b>В дискусии участвуют следующие \"авторы\" речей:</b></div>";	//пробегаемся по всему массиву и находим наших	foreach($SpeechArr as $rr){			//var_dump($rr);		if(isset($rr['SpeechArr'])){			echo "<b>".$rr['SpeechArr']['0']['Who']."</b> - <span style='color:green;'>речь найдена!</span><br />";		}else{			//пробегаемся по массиву всех авторов и находим нужного			foreach($arrWho as $av){					if($av['id'] == $rr['id_avtor']){ echo "<b>".$av['Who']."</b> - <span style='color:red;'>речей по заданому фильтру не найдено!</span><br />"; }			}		}	}							?> 		<script>//вывод меню персоны				var IdWho = '';//id автора речи				function ShowAdminMenu(obj,event){//выводим меню к персоне					//alert(obj.id+'ShowAdminMenu');					var id = obj.id.split("-")[1];					var id_news = obj.getAttribute('idd');					//alert(id_news);					IdWho = id;					var opt = new Array(); //параметры					opt.IndexZ = 4 //IndexZ					//opt.fixed = 'fix'; //означает, что она зафиксирована экране					var elemMenu = CreateElementOnScreen(260,event,opt);					elemMenu.innerHTML = "<span onclick='deletElem(this)' id='delme' style='cursor:pointer; float:right; margin: -10px -5px 0 0;' > <span style='color:black;'>_</span><b>x</b><span style='color:black;'>_ </span></span><br />";  //закрывание этого списка										<?if($_SESSION['Guest_id']['id_user'] == $AdminID){ //если я админ	?>						elemMenu.innerHTML += "<div id='idWh-"+id+"' onclick='ShowFotoMen(this)' style='text-decoration:underline; cursor:pointer;'>Прикрепить фото</div>";						elemMenu.innerHTML += "<div><a style='color:white;' href='Last_20.php?id_news="+id_news+"' >Изменить текст речи</a></div>";					<?}?>					elemMenu.innerHTML += "<div id='idStruc-"+id+"' onclick='ShowCtructureOfPersons(this)' style='text-decoration:underline; cursor:pointer;'>Кто такой?</div>";					document.body.appendChild(elemMenu);					}								function deletElem(obj){//удаляем элемент меню				//var elem = document.getElementById('CalendarDiv');				obj.parentNode.style.display = 'none';				obj.parentNode.parentNode.removeChild(obj.parentNode);				}								function ShowCtructureOfPersons(obj){//открываем новое окно со структурой авторов/персон					var id_avt = obj.id.split('-')[1];					var addr = 'PersonsStruct.php?avtor='+id_avt;					var popupWin = window.open(addr,"","menubar=yes,width=900,height=600,location=no,toolbar=no,menubar=no,status=no,scrollbars=yes,resizable=yes'");					popupWin.focus();				} 							</script>						<?					//н-11111111-2		//$onclick ='';			$onclick = " onclick='ShowAdminMenu(this,event)' ";		//если я админ то добавляем меню, с возможностями: добавить фото к персоне					if($_SESSION['Guest_id']['id_user'] == $AdminID){ //если я админ			 //echo "Вы Админ продолжаем дальше<br /><br />";				?>								<iframe  name="h_iframe" width="700" height="100" style="display: none;"></iframe><!--фрейм для загрузки страницы  onchange="document.forms['img_upload'].submit();"  -->				 <div id="picoBody" style="display:none;" style='border:1px solid green;'>					<h2 id='DobFotoLable'>Добавление фото к </h2>					<form  id="linkForm2" method="post" action="blocks/dinamic_scripts/loadPicture.php?path=FotoAvtors&size=150"  name="img_upload" enctype="multipart/form-data" target="h_iframe">						<div id="imageId">							 							  <img src="img/loadinfo1.gif" style="display:none;" />						 </div>						 <div id="image_upload_status"></div>							 <p><input id="showfiles1" type="file" name="userfileComment"  /></p>						 <input id="srcFoto" type="text" name="srcFoto"   />						 <input id="TextArea1" type="hidden" name="srcFoto"  />					</form>				</div>				<script type="text/javascript" src="js/jquery.js"></script> <!--подключаем -->			<script type="text/javascript">//работа с фотографией			//var keyF = '';			function ShowFotoMen(obj){//показ формы добавления картинки					//alert(IdWho+'ShowFotoMen');					var DivFoto = document.getElementById('picoBody');					DivFoto.style.display = 'block';					deletElem(document.getElementById('delme'));					//document.getElementById('avt-'+IdWho).innerHTML					//пишем автора над фото					document.getElementById('DobFotoLable').innerHTML ="Добавление фото к "+document.getElementById('avt-'+IdWho).innerHTML;					//очишаем форму					document.getElementById('image_upload_status').innerHTML ='';					document.getElementById('srcFoto').value ='';					document.getElementById('showfiles1').value ='';			}			$(document).ready(function() { 				$('#showfiles1').change(function(){ 						document.forms['linkForm2'].submit();						//сохраняем к автору картинку						setTimeout(function(){//откладываем событие на пол секунды							var srcFoto = document.getElementById('srcFoto').value;														if(srcFoto !=''){								var _ids;									$.ajax({									  async: false, 									  url: 'blocks/dinamic_scripts/Change_Pole.php',									  data: {Table:'Speech_Who',PoleVal:'Foto',Value:srcFoto,PoleWhere:'id',Where:IdWho},									  type: "POST",									  success: function(data) {  _ids = data; }//,									//dataType: 'json'									 })									//alert(_ids);															}						}, 3000);				});				});			</script>					<?}		//к-11111111-2		//создаем таблицу высказываний	?>	<br /><div class='vdiskus' ><b>Дискуссия/высказывания</b></div><br /><br />		<div ><!--style='overflow:auto;'-->	<table ><!--border="1px solid blue"-->				<?		//постраничная навигация		//$num = 5; //речей на странице		//$Npage = 'page'; //для работы в строке запроса		if(isset($_GET['page'])){			$page = sprintf("%d",$_GET['page']);		}else{			$page=1;		}		$start = $page * $num - $num;		$end = $page * $num;				$schet = 0;				foreach($arrOfDate as $arD){//пробегаемся по массиву дат		//for($ar=0; $ar<count($arrOfDate); $ar++){//пробегаемся по массиву дат									echo "<tr>";				$lastAvtorFounded = -1; //последний номер (столбец) автора, у которого была найдена/выведена речь на эту дату								for($i=0; $i<count($SpeechArr); $i++){				//foreach($SpeechArr as $speechMem){//каждый пробегаемся по масивам речей					if($wasTR){$lastAvtorFounded =-1;}//если мы меняем автора, при уже найдной речи и после создания новой строки tr					$wasTR = false; //был перенос стороки					$foundInAvtor = false;//была ли уже речь у этого же автора в эту же дату										if($SpeechArr[$i]['SpeechArr']){						foreach($SpeechArr[$i]['SpeechArr'] as $speech){						//foreach($speechMem['SpeechArr'] as $speech){//пробегаемся по каждой речи							if($speech['date'] == $arD){																							if($foundInAvtor){ echo "<tr>"; $lastAvtorFounded =-1; }//если мы повторно находим эту же дату у этого же автора, то перескакиваем на след строку									for($j=0; $j<$i;$j++){ //проставляем нужное количество пустых столбцов										if(($j > $lastAvtorFounded) ){											//echo "<td>".$lastAvtorFounded."=".$j."=".(bool)$foundInAvtor."</td>";											echo "<td></td>";										}									}								?>									<td>																														<!--<?=$lastAvtorFounded?>=<?=$i?>=<?=(bool)$foundInAvtor?><br />-->										<?//преобразуем дату										$ad = explode(' ',$speech['date']);	$ad = explode('-',$ad['0']);										$datt = $ad[2]." ".$ArrMonth[(int)$ad[1]]." ".$ad[0];										//http://localhost/socset/SpeechWind.php?IdSBEnd=11|13										?>																				<?//metka1  проверяем, что если мы отбираем по сайтмапу только определенные речи										if((isset($IdBeg) AND isset($IdBeg)) AND ($speech['id_speech']>$IdEnd OR $speech['id_speech']<$IdBeg)){}else{ //(isset($IdBeg) AND isset($IdBeg)) AND ?>											<?$schet++; if(($schet > $start) AND ($schet < ($end+1))){	//страничный вывод?>														<div style='position:relative; padding:5px; margin:5px; border:1px solid #e3e3e3; background: #e3e3e3; -moz-border-radius: 20px; -webkit-border-radius: 20px; border-radius: 20px;'>													<?//=$speech['id_speech']?>														<!--position:absolute;  style="top:-50px; position: relative; margin-bottom: -50px;-->														<!--<div style=' border:1px solid #ccc; float:left; margin:7px; margin-top:-40px;  margin-left:0px; background:white; Z-index:10;' align='center' >-->														<div style='margin-left:-10px; border:1px solid #ccc; float:left;   top:-55px; position: relative; margin-bottom: -50px; margin-right: 8px; width:130px; background: white; -moz-border-radius:10px; -webkit-border-radius:10px; border-radius: 10px;' align='center' >															<div style='position:absolute; float:right; left:127px; top:-14px;'><b style='color:red; cursor:pointer;' onclick="this.parentNode.parentNode.style.display='none'; return false;" >x</b></div>															<?if($speech['Foto'] ==''){ $ff = 'FotoAvtors/No_Foto.jpg';}else{$ff = ''.$speech['Foto'];}?>															<img <?=$onclick?> id='WhI-<?=$speech['id_who']	?>' src='<?=$ff?>' style='width:120px;' idd='<?=$speech['id_news']?>'  /><br />															<a href='PersonsStruct.php?avtor=<?=$speech['id_who']?>' id='avt-<?=$speech['id']?>' title='<?=$speech['descript']?> <?=$speech['Who']?> в структуре мировой иерархии подчинености (должность, положение, начальство, подчиненность)' ><?=$speech['Who']?></a><br />															<b style='font-size:12px;' title='<?=$speech['date']?>' ><?=$datt?></b>														</div>														<!--<div style='min-width:130px;min-height:100px; float:left; height:100px; width:100px; '>														</div>				-->																					<? if($speech['url_id']){															//обрезаем новость															$ns = 55; //кол-во символов															$news_tit = $speech['news_title'];															if (mb_strlen($news_tit,'UTF-8') > $ns)																$news_tit =  mb_substr($news_tit, 0, $ns, 'UTF-8').'...';																															//перетасовываем новость для title															$arr_slov = explode(" ",$speech['news_title']); $nslov = count($arr_slov); $nslov = floor($nslov/2);															$titl_n = array();															$titl_e = array();															for($d=0; $d<count($arr_slov);$d++){ 																if($d<$nslov){																	$titl_n[] =$arr_slov[$d]; 																}else{																	$titl_e[] =$arr_slov[$d];																} 															}															$titl_n = implode(" ",$titl_n); $titl_e = implode(" ",$titl_e);															 $titl_n = $titl_e." ".$titl_n;														?>																														<a href='index.php?c=soobsh&id_soobsh=<?=$speech['url_id']?>' target='_blank' title='<?=$titl_n?>' style='font-size:12px;'>Из новости-> <?=$news_tit?> </a><br/>														<?}?>														<?=$speech['speech']?><?//var_dump($speech);?>													</div>											<?}?>										<?}?>									</td>								<?								if($foundInAvtor){ echo "</tr>"; $wasTR=true;}								$foundInAvtor = true;								$lastAvtorFounded = $i;							}												}					}				}			echo "</tr>";		}?>			</table>	</div><?$posts = $schet;// Находим общее число страниц$total = (($posts - 1) / $num) + 1;$total =  intval($total);echo "счет-".$schet;echo "total-".$total;echo "avtor-".$avtor;/**/if ($page != 1) $pervpage = '<a href=SpeechWind.php?avtor='.$avtor.'&page=1>Первая</a> | <a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page - 1) .'>Предыдущая</a> | ';// Проверяем нужны ли стрелки впередif ($page != $total) $nextpage = ' | <a href=SpeechWind.php?avtor='.$avtor.'&page='.($page + 1).'>Следующая</a> | <a href=SpeechWind.php?avtor='.$avtor.'&page='.$total.'>Последняя</a>';// Находим две ближайшие станицы с обоих краев, если они естьif($page - 5 > 0) $page5left = ' <a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page - 5) .'>'. ($page - 5) .'</a> | ';if($page - 4 > 0) $page4left = ' <a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page - 4) .'>'. ($page - 4) .'</a> | ';if($page - 3 > 0) $page3left = ' <a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page - 3) .'>'. ($page - 3) .'</a> | ';if($page - 2 > 0) $page2left = ' <a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page - 2) .'>'. ($page - 2) .'</a> | ';if($page - 1 > 0) $page1left = '<a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page - 1) .'>'. ($page - 1) .'</a> | ';if($page + 5 <= $total) $page5right = ' | <a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page + 5) .'>'. ($page + 5) .'</a>';if($page + 4 <= $total) $page4right = ' | <a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page + 4) .'>'. ($page + 4) .'</a>';if($page + 3 <= $total) $page3right = ' | <a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page + 3) .'>'. ($page + 3) .'</a>';if($page + 2 <= $total) $page2right = ' | <a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page + 2) .'>'. ($page + 2) .'</a>';if($page + 1 <= $total) $page1right = ' | <a href=SpeechWind.php?avtor='.$avtor.'&page='. ($page + 1) .'>'. ($page + 1) .'</a>';// Вывод меню если страниц больше однойif ($total > 1){Error_Reporting(E_ALL & ~E_NOTICE);echo "<div class=\"pstrnav\">";echo $pervpage.$page5left.$page4left.$page3left.$page2left.$page1left.'<b>'.$page.'</b>'.$page1right.$page2right.$page3right.$page4right.$page5right.$nextpage;echo "</div>";}//к-11111-1 }else{//выводим всех авторов//var_dump($arrWho);	if(!isset($_GET['AllBy5'])){		$count=0;		echo "<h2>Или просто выберите ниже чью речь, обращения и высказывания вы хотите просмотреть:</h2>";			foreach($arrWho as $who){			$count++; ?>				<hr /><br /><?if(($count<10) AND ($who['Foto'] !='') ){?><img src="<?=$who['Foto']?>" align="middle"  /><?}?>&nbsp;&nbsp;&nbsp;<a style="color:purple; font-size:20;" href ="SpeechWind.php?avtor=<?=$who['id']?>" ><?=$who['Who']?></a> 		<?	}	}}?><?include('checker.php');?></body></html>